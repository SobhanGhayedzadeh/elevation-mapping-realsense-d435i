# ROS Elevation Mapping with RealSense Camera

This ROS package is designed for elevation mapping using a mobile robot equipped with a RealSense camera. It is based on the [Robot-Centric Elevation Mapping](https://github.com/ANYbotics/elevation_mapping), with modifications tailored for RealSense camera integration. The package generates elevation maps from RealSense camera data, utilizing the point cloud generated by the camera and the built-in IMU of the RealSense D435i for odometry (Pose With Covariance). It can also be used without odometry to solely generate elevation maps. After creating an elevation map, the traversability map, which is based on [Traversability Estimation](https://github.com/leggedrobotics/traversability_estimation), will launch. The traversability estimation filters will be applied to the elevation map. The traversability map uses the same regular grid as the elevation map. It locally describes the traversability for navigation, based on three different terrain characteristics: the local slope s, the local terrain roughness r, and the local step height h.



### What Camera Sees
![pic](/elevation_mapping_demos/doc/Elevation_mapping.png)

### Generated Elevation and Traversability Map 
![gif](/elevation_mapping_demos/doc/Video_elevation_mapping.gif)


## Installation

### Prerequisites

This software is built on the Robotic Operating System (ROS), which needs to be first. Additionally, the Robot-Centric Elevation Mapping depends on following software:

- [ROS - noetic](http://wiki.ros.org/ROS/Installation)

### Dependencies

- [Realsense](https://github.com/IntelRealSense/realsense-ros/tree/ros1-legacy) (ROS Wrapper for Intel® RealSense™ Devices)
- [Grid Map](https://github.com/anybotics/grid_map) (grid map library for mobile robots)
- [kindr](http://github.com/anybotics/kindr) (kinematics and dynamics library for robotics),
- [kindr_ros](https://github.com/anybotics/kindr_ros) (ROS wrapper for kindr),
- [Point Cloud Library (PCL)](http://pointclouds.org/) (point cloud processing),
- [Eigen](http://eigen.tuxfamily.org) (linear algebra library)
- [Message Logger](https://github.com/ANYbotics/message_logger) (An Interface for Message Logging)
- [ANY Node](https://github.com/ANYbotics/any_node) (Set of wrapper packages to handle multi-threaded ROS nodes)


### Installation Steps

1. Clone this repository into your catkin workspace:

    ```bash
    cd ~/catkin_ws/src
    git clone https://github.com/SobhanGhayedzadeh/elevation_mapping_realsense_d435i.git
    ```

2. Build the package:

    ```bash
    cd ~/catkin_ws
    catkin_make
    ```

## Elevation Mapping

This is the main Robot-Centric Elevation Mapping node. It uses the distance sensor measurements and the pose and covariance of the robot to generate an elevation map with variance estimates.


#### Subscribed Topics

* **`/camera/depth/color/points_downsampled`** ([sensor_msgs/PointCloud2])

    The distance measurements derived from thes d435i are downsampled to every 6 cm, reducing computational load.

* **`/pose`** ([geometry_msgs/PoseWithCovarianceStamped])

    The robot pose and covariance can be obtained from any sensors capable of providing odometry (In here we used odometry from Rtabmap). Additionally, there is a node available to deactivate pose data, allowing the node to be launched with the camera motionless.

#### Published Topics

* **`elevation_map`** ([grid_map_msgs/GridMap])

    The entire (fused) elevation map. It is published periodically (see `fused_map_publishing_rate` parameter) or after the `trigger_fusion` service is called.

* **`traversability_map`** ([grid_map_msgs/GridMap])

	The current traversability map. The traversability map (see the topic `/traversability_map_visualization/roughness_map`) can be configured with the traversability filters. 


#### Parameters

Adjust parameters in the launch file to customize the mapping behavior.

* **`robot_pose_with_covariance_topic`** 
    You can modify the pose and frame for different applications. Additional parameters can be found in the [Robot-Centric Elevation Mapping](https://github.com/ANYbotics/elevation_mapping). 


## Usage

For using this package, you can choose to utilize the `rtabmap posewithcovariance` or opt not to use it. 

1. Launch the elevation mapping node with rtabmap pose with covariance (Allowing the camera to rotate and move):


    ```bash
    roslaunch elevation_mapping elevationMap_realsense_d435i.launch pose:=true traversability:=true
    ```

Note: make sure to slowly rotate the camera to activate the rtabmap at the start of launching

2. Launch the elevation mapping node without any pose with covariance (Camera is motionless):

    ```bash
    roslaunch elevation_mapping elevationMap_realsense_d435i.launch pose:=false traversability:=true
    ```

    After launching, an RViz configuration will load for visualization of the elevation map.

## License

This project is licensed under the [MIT License](LICENSE).


